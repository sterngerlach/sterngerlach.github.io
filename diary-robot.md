
---
title:  ロボット作成日記
author: SternGerlach
---

<!--
 pandoc -s --filter pandoc-crossref -M "crossrefYaml=./crossref_config.yaml" -f markdown -t html5 --mathjax --css style.css diary-robot.md > diary-robot.html
-->

# このページについて

ロボット作成の実験で行ったことをまとめていきます。

## 2018年9月24日 (月曜日)

初回の実験。Raspberry Piのセットアップを行っていたらあっという間に時間が過ぎてしまった。班分けが勝手に決められてしまったのは残念だったけど仕方がない。

- Raspberry Piのセットアップ
    - ヒートシンクがRaspberry Piに既に装着されていた。また、MicroSDカードには既にUbuntu Mate 16.04.3 LTSがインストールされていたので、OSのインストール作業(イメージファイルのダウンロード、SDカードへのイメージファイルの書き込み、OSのセットアップ)は省略することができた。去年実験を行った人がそのままにしていったのだと思う。
    - Raspberry PiのIPアドレスが、DHCPによって動的に割り振られないように、静的アドレスに設定した。
    - Raspberry PiのI2CバスとSPIバスが有効になっていることを確認した。

- サウンドの設定
    - Raspberry Piから音声を出力させるのにかなり手間取った。`aplay`コマンドを起動するとエラーが出力されて異常終了してしまったが、これは設定ファイルに謎のゴミが含まれていたためで、設定ファイルを修正する必要があった。説明書通りに設定を行っても、スピーカーから出る音が非常に小さい。スピーカーの設定は一旦取りやめることにした。マイクの接続とマイク音声の録音については問題はなかった。

- 各種ソフトウェアのインストールとセットアップ
    - OpenCV、WiringPi、Julius(音声認識ソフトウェア)は既にインストールされていた。
    - 音声認識のテストは非常に大変だった。説明書通りのコマンドを実行しても、上手く日本語を認識してくれない。それ以前に、説明書の日本語がよく理解できない。何をしようとしているのかもよく分からない。例えば、シェルスクリプトを書き換えろと言われているが、そのシェルスクリプトの在り処が分からない。音声認識を実行するために入力しなければならないコマンドが誤っている。シンボリックリンクを張れといわれているが、そもそもシンボリックリンクを張る必要性が無い。結局仕様書を頼るのは諦めて、インターネットで使用法を調査する必要に迫られる。「仕様書なるものは過信してはいけない」ということを学生の間に教え込もうとしているに違いない。
    - 超音波センサのテストも手こずったが、こちらは仕様書をじっくり読めば何とか理解できた。
    - Webカメラのテストは非常に簡単であった。WebカメラをRaspberry Piに接続したあと、C++とOpenCVで書かれたテストプログラムをコンパイルして実行するだけであった。

初回の実験では、誤植の多い実験書に翻弄された感じだった。自分が想定していないところでエラーが出て、時間が取られる。本当に世話が焼ける。昨年実験を行ったときの設定などがそのまま残されていて、何か悪さをしているに違いないと思われる。ここまで手こずるならOSのインストールからやり直せばよかったと後悔した。すっかり体力を奪われた。

## 2018年10月1日 (月曜日)

2回目の実験。Pythonの`pip`コマンドが動作しなくて本当に困った。動作しない原因が本当によく分からない。

- 各種ソフトウェアのインストールとセットアップ
    - pthreadのテストは直ぐに終わった。C++で書かれたpthreadのテストプログラムをコンパイルして実行するだけであった。C++はよく分かりません。

- アルミフレームの組み立て
    - アルミフレームの組み立ては同じ班の人にお願いした。折角苦労して取り付けたフレームを取り外してしまって、班の人を不機嫌にさせてしまったので申し訳なかった。ハードはやらないと決めた。

- ステッピングモータの動作
    - 自分はステッピングモータを回転させるための準備を行った。とはいっても、ロボット本体にモータを取り付けるためのアルミ板(アルミブラケット)に、モータをネジで固定するだけであった。モータ電源の接続は少し大変であった。モータドライバと電源装置とを接続するための配線は自作する必要があったが、そのことは説明書には特に書かれていなかった。やはり説明書を信用してはいけなかった。配線を自作するといっても、導線を適当な長さに切って、先端の被膜を剥がすだけである(不器用なのでこれも時間が掛かる)。
    - 電源装置とモータドライバとの間には緊急停止ボタンを接続するように指示されていた。緊急停止ボタンに配線を繋ぐときに、グランドを一箇所にまとめる必要があるということに気付かなかった(説明書が良くない)。このせいで、モータを回転させるまでにかなり時間が掛かった。断線していないかどうか、電圧値は正しいかどうかなどをテスターを用いて細かく調べた。電源装置の使い方もマニュアルで確認した。
    - テストプログラムをコンパイルして実行すると、モータは回転してくれた。実行ファイルに与えるパラメータの意味は、ソースコードを解読すれば理解できると思う(まだソースコードを読んでいないのでよく分からない)。WiringPiなるライブラリの使用法についても調べる必要がある。

- `pip`コマンドが動作しない
    - `pip`コマンドが動かないのでライブラリをインストールできない。`Could not find a version that satisfies the requirement`で始まるエラーが出て止まる。`pip`をバージョン8.1.1からバージョン18.0にアップデートすると(`pip install --upgrade pip`)、`pip`コマンドそのものが使えなくなってしまう(`python3 -m pip`と入力しなければならない)。またアップデートしてもライブラリがインストールできないという状況に変わりはなかった。
    - Pythonのバージョンを3.5.2から3.6.1に引き上げる、Python関連のパッケージを再インストールする、`pip`のバージョンを色々と変える(8.1.1、9.0.2、10.0.1、18.0など)、`get-pip.py`経由で`pip`を導入する、仮想環境を作成してその内部でパッケージのインストールを実行するなど、思い付く限りの方法を片っ端から試してみたが、どれも上手く行かない。パッケージ(Tensorflow、OpenCV-Pythonの2つ)をインストールしようとして3時間以上格闘したが、結局疲れ果てて心が折れてしまった。

昼ご飯を忘れて作業をしていた。昼ご飯を取ったのは午後2時を過ぎてからのことだった。この実験には底知れぬ闇が広がっている。

## 2018年10月5日 (金曜日)

`pip`よ、動いてくれ。

- `pip`コマンドが復活
    - このままPythonのライブラリがインストールできないと非常に困るので金曜日なのに作業をした。最初に取り掛かったのは、Python 3.5.2を再インストールする(`apt-get install --reinstall python3-dev`)ことだった。依存関係が壊れるなどの細かいトラブルはあったが、何とかなったので一安心した。`pip`コマンドはバージョンが8.1.1だとどうやら古過ぎるみたいなので、バージョン9.0.2を導入した(`python3 ./get-pip.py pip==9.0.2`)。

- TensorflowとKerasのインストール
    - Tensorflowは、`python3 -m pip install tensorflow`のコマンドを叩くだけでインストールが完了した。数分経っても端末の画面が更新されないことがあり不安になったが、`ps`コマンドで確認してみると、どうやらインストール時に必要なライブラリをコンパイルしていて、そのコンパイルに物凄く時間が掛かっているためだった。`python3 -c "import tensorflow as tf; print(tf.__version__)`のコードが正常に動作したときの安心感は忘れられない。Kerasも全く問題なくインストールできた(`pip install keras`)。これで友人がプログラムを作れる。
    - Tensorflowのインストールでは以下のページを大いに参考にした。
        - [Raspberry pi 3 type Bにtensorflowをインストールする](https://qiita.com/yuzo63/items/4636479c8fe3e80e14f1)
        - [raspberry pi 3にTensorFlowを入れて画像認識させる](http://ken5owata.hatenablog.com/entry/2017/06/12/232516)

- OpenCVのインストール
    - OpenCV-Pythonは、`pip install opencv-python`と`pip install opencv-contrib-python`のいずれも、`Could not find a version that satisfies the requirement`のエラーが出て動かなかったので、仕方なくソースコードをビルドしてインストールすることにした。
    - `Note that the wheel format does not currently support properly ARM architecture so there are no packages for ARM based platforms in PyPI`と[PyPIのopencv-pythonのページ](https://pypi.org/project/opencv-python/)に記載されているので、恐らくこれが原因と思われる。
    - OpenCVのインストールでは以下のページを参考にした。インストールするOpenCVのバージョンは3.4.3とした。
        - [Raspbian (Raspberry Pi 3 model B) に OpenCV 3.1 をインストールする](https://a244.hateblo.jp/entry/2016/10/18/053000)
        - [ラズパイにOpenCVをインストールする方法](https://qiita.com/takahiro_itazuri/items/a67dd3bb7f5f88ca9dd8)
        - [Raspberry Pi講座 Python3 + OpenCV3(環境構築編)](https://sites.google.com/site/memorandumjavaandalgorithm/raspberry-pi-jiang-zuo-opencv3)
        - [Ubuntu OpenCVをインストールする手順](https://www.trifields.jp/how-to-install-opencv-on-ubuntu-2742)

- 地味な作業
    - ロボットの高さ、奥行き、横幅、車輪の間隔、車輪の半径などを定規で大まかに測定した。
    - SSHでRaspberry Piに(踏み台サーバを経由して)リモートログインできることを確認した。

OpenCVをビルドしている最中に午後6時を回ってしまったので、次の実験ではビルドを途中から行うことになった。ここまで環境構築に時間が取られるとは思ってもいなかった。
